name: Docker Image Sync

on:
  workflow_dispatch:
    inputs:
      image_name:
        description: 'æºé•œåƒå (ä¾‹å¦‚ elasticsearch)'
        required: true
        default: 'elasticsearch'
      image_tag:
        description: 'é•œåƒç‰ˆæœ¬å· (ä¾‹å¦‚ 7.4.2)'
        required: true
        default: '7.4.2'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Aliyun Registry
        run: |
          echo "${{ secrets.ALIYUN_PASSWORD }}" | docker login --username=${{ secrets.ALIYUN_USERNAME }} --password-stdin ${{ secrets.ALIYUN_REGISTRY }}

      - name: Pull, Tag and Push
        run: |
          # 1. å®šä¹‰å˜é‡
          SOURCE_IMAGE="${{ github.event.inputs.image_name }}:${{ github.event.inputs.image_tag }}"
          # è¿™é‡Œä¼šè‡ªåŠ¨åŒ¹é…ä½ åœ¨é˜¿é‡Œäº‘å»ºçš„ä»“åº“å
          TARGET_IMAGE="${{ secrets.ALIYUN_REGISTRY }}/clannadxi/${{ github.event.inputs.image_name }}:${{ github.event.inputs.image_tag }}"
          
          echo "ğŸš€ æ­£åœ¨ä» Docker Hub æ‹‰å–: $SOURCE_IMAGE"
          docker pull $SOURCE_IMAGE
          
          echo "ğŸ·ï¸  æ­£åœ¨æ‰“æ ‡ç­¾ä¸º: $TARGET_IMAGE"
          docker tag $SOURCE_IMAGE $TARGET_IMAGE
          
          echo "ğŸ“¤ æ­£åœ¨æ¨é€åˆ°é˜¿é‡Œäº‘..."
          docker push $TARGET_IMAGE
          
          echo "=========================================="
          echo "âœ… åŒæ­¥æˆåŠŸï¼"
          echo "è™šæ‹Ÿæœºæ‹‰å–å‘½ä»¤ï¼šdocker pull $TARGET_IMAGE"
          echo "=========================================="